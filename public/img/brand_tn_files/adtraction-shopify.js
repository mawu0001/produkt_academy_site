"use strict";var ADTERRORHANDLER=ADTERRORHANDLER||{logErrorUrl:"https://log.adtraction.fail/error",captureError:function(e,o){try{var t={version:"16",source:"adtraction-shopify-theme-extension-production",name:e.name,message:e.message,url:window.location.href,stack:e.stack},n=ADTERRORHANDLER.logErrorUrl;if(n&&n.length>0)if(o){var r=document.createElement("img");r.src=n+"?"+ADTERRORHANDLER.errorBodyToUrlQuery(t),r.width=1,r.height=1,r.style.cssText="display:none",document.body.appendChild(r)}else if(navigator.sendBeacon)navigator.sendBeacon(n,JSON.stringify(t));else if(window.XMLHttpRequest){var s=new XMLHttpRequest;s.open("POST",n,!0),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(t))}}catch(e){console.error(e)}},errorBodyToUrlQuery:function(e){var o=[];for(var t in e)e.hasOwnProperty(t)&&o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")}};!function(){const e="at_gd",o="adtr_debug";let t=!1,n=null;new URL(window.location.href).searchParams.get("debug")&&sessionStorage.setItem(o,"true"),sessionStorage.getItem(o)&&console.log("[ADTR] Started");try{function r(e,o,t){const n=new Date;n.setTime(n.getTime()+24*t*60*60*1e3);let r="expires="+n.toUTCString();document.cookie=e+"="+o+";"+r+";path=/"}function s(e){const o=`; ${document.cookie}`.split(`; ${e}=`);return 2===o.length?o.pop().split(";").shift():null}function i(t){if(!t)return;sessionStorage.getItem(o)&&console.log("[ADTR] Adding at_gd to form:",{name:e,value:t});const n=document.querySelector('.product-form form[action="/cart/add"]');if(n){let r=n.querySelector(`input[name="properties[_${e}]"]`);r?r.value=t:(r=document.createElement("input"),r.type="hidden",r.name=`properties[_${e}]`,r.value=t,n.appendChild(r)),sessionStorage.getItem(o)&&console.log("[ADTR] at_gd added to form:",{name:r.name,value:r.value})}}function a(){const a=new URL(window.location.href).searchParams.get(e);var c;a?(n=a,t?(r(e,a,365),sessionStorage.getItem(o)&&console.log("[ADTR] Cookie set:",{name:e,value:a})):sessionStorage.getItem(o)&&console.log("[ADTR] Query param at_gd found but consent not given, proceeding without setting cookie.")):t&&(n=s(e)),i(n),(c=n)&&fetch(window.Shopify.routes.root+"cart/update.js",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({attributes:{[`__${e}`]:c,adtraction:c}})}).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((t=>(sessionStorage.getItem(o)&&(console.log("[ADTR] Cart updated:",t),console.log("[ADTR] at_gd added as cart attribute:",{name:`__${e}`,value:c})),fetch(window.Shopify.routes.root+"cart.js",{method:"GET"})))).then((e=>{if(!e.ok)throw new Error("[ADTR] Network response was not ok");return e.json()})).then((e=>{sessionStorage.getItem(o)&&console.log("[ADTR] Current cart token:",e.token)})).catch((e=>console.error("[ADTR] Error updating cart:",e)))}function c(){try{const e=document.cookie.split("; ").find((e=>e.startsWith("_tracking_consent=")));if(!e)return;const t=JSON.parse(decodeURIComponent(e.substring(18)));if(!1===t.display_banner)return;const{CMP:n}=t.con;if(""===n.a&&""===n.m)return!1;const r="1"===n.a&&"1"===n.m;return sessionStorage.getItem(o)&&console.log("[ADTR] Cookie consent:",{analytics:n.a,marketing:n.m,hasConsent:r}),r}catch(e){return void(sessionStorage.getItem(o)&&console.log("[ADTR] Cookie consent error:",e))}}function l(){if(void 0===window.Shopify||void 0===window.Shopify.customerPrivacy){const e=c();return void 0!==e?e:(sessionStorage.getItem(o)&&console.log("[ADTR] No consent framework or cookie found."),!0)}if("function"==typeof window.Shopify.customerPrivacy.analyticsProcessingAllowed&&"function"==typeof window.Shopify.customerPrivacy.marketingAllowed)return sessionStorage.getItem(o)&&console.log("[ADTR] Analytics allowed:",window.Shopify.customerPrivacy.analyticsProcessingAllowed(),"Marketing allowed:",window.Shopify.customerPrivacy.marketingAllowed()),!0===window.Shopify.customerPrivacy.analyticsProcessingAllowed()&&!0===window.Shopify.customerPrivacy.marketingAllowed();if("function"==typeof window.Shopify.customerPrivacy.currentVisitorConsent){const e=window.Shopify.customerPrivacy.currentVisitorConsent();return sessionStorage.getItem(o)&&console.log("[ADTR] Consent status:",e),e&&"yes"===e.marketing&&"yes"===e.analytics}return!0}t=l(),sessionStorage.getItem(o)&&console.log("[ADTR] Initial consent status:",t);(new URL(window.location.href).searchParams.get(e)||t)&&a(),document.addEventListener("visitorConsentCollected",(e=>{const{marketingAllowed:n,analyticsAllowed:r}=e.detail;if(n&&r){t=!0,sessionStorage.getItem(o)&&console.log("[ADTR] Consent granted:",e.detail);try{a()}catch(e){ADTERRORHANDLER.captureError(e,!1)}}else sessionStorage.getItem(o)&&console.log("[ADTR] Consent not granted:",e.detail)}));const d=new MutationObserver((()=>{n&&i(n)}));document.addEventListener("DOMContentLoaded",(()=>{d.observe(document.body,{childList:!0,subtree:!0})}))}catch(u){ADTERRORHANDLER.captureError(u,!1)}}();