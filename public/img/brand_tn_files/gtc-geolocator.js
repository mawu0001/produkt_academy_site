import{gtcHandleize,gtcGetCookie,gtcSetCookie}from"gtcUtils";import{gtcModal}from"gtcOpener";class GTCGeolocator extends gtcModal{#shouldOpen=!1;constructor(){super()}connectedCallback(){super.connectedCallback(),this.dom={countryItems:this.querySelectorAll("[data-country-code]")},this.settings={cookieName:"GTC_GEOLOCATOR",currentCountry:this.getAttribute("current-country")||"",currentPageType:this.getAttribute("current-page-type")||"",translate:this.getAttribute("translate"),designMode:this.getAttribute("data-design-mode")||!1},this.settings.designMode?this.open():gtcGetCookie(this.settings.cookieName)===null&&this.initGeoLocator(),super.addListeners(),this.dom.countryItems.forEach(item=>{item.addEventListener("click",this.handleRedirect.bind(this))})}disconnectedCallback(){super.disconnectedCallback(),super.removeListeners(),this.dom.countryItems.forEach(item=>{item.removeEventListener("click",this.handleRedirect.bind(this))})}async handleRedirect(event){if(!(event.target instanceof HTMLAnchorElement))return;if(["product","collection","page"].includes(this.settings.currentPageType)){event.preventDefault();const url=new URL(event.target.href);url.pathname=window.location.pathname.slice(1),url.search="";let response=null;try{response=await fetch(`${url.toString().replace("www.","")}.json`)}catch(error){console.error(error)}if(response&&response.status===200){window.location.href=url.toString();return}window.location.href=event.target.href}else this.close()}async initGeoLocator(){const country=await this.getCountry();this.settings.translate&&this.translate(country);const fallback=Array.from(this.dom.countryItems).find(item=>item.getAttribute("data-fallback")!==null),match=Array.from(this.dom.countryItems).find(item=>item.getAttribute("data-country-code")===country);match?match.getAttribute("data-country-code")!==this.settings.currentCountry&&(match.classList.add("is-recommended"),this.#shouldOpen=!0):fallback&&(fallback.classList.add("is-recommended"),this.#shouldOpen=!0),this.#shouldOpen?this.open():this.close()}async getCountry(){const body=await(await fetch("https://get.geojs.io/v1/ip/country.json")).json();return gtcHandleize(body.country)}translate(country){let lang=navigator.language||navigator.userLanguage;this.settings.translate==="geojs"&&(lang=country);const regionNamesByBrowser=new Intl.DisplayNames([lang,"en"],{type:"region"});Array.from(this.dom.countryItems).forEach(item=>{const countryCode=item.getAttribute("data-country-code"),countryName=regionNamesByBrowser.of(countryCode.toUpperCase()),name=item.querySelector("[data-country-name]");name&&(name.textContent=countryName)})}close(){super.close(),gtcSetCookie(this.settings.cookieName,"true",30)}}customElements.get("gtc-geolocator")||customElements.define("gtc-geolocator",GTCGeolocator);
//# sourceMappingURL=/cdn/shop/t/298/assets/gtc-geolocator.js.map?v=162247638523060865401741080004
