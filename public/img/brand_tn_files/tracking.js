(()=>{sessionStorage.getItem("bai-tracking-debug");var t=null,e=null;function n(t,e,n=!1){if(function(t){return t.startsWith("[[")&&t.endsWith("]]")}(t)){const n=t.slice(2,-2);return new RegExp(n).test(e)}{const o=t.split("|");for(const t of o)if(i(t,e,n))return!0;return!1}function i(t,e,n=!1){if(t.includes("{")&&t.includes("}")){let e=t.indexOf("{"),i=t.indexOf("}"),o=t.substring(e,i+1),a=o.substring(1,o.length-1);if(!n)if(a.includes("&&")){let t=a.split("&&");for(let e=0;e<t.length;e++){let n=t[e],i=n.startsWith("!");if(n=n.substring(1),document.body.innerText.toLowerCase().includes(n)==i)return!1}}else{let t=a.startsWith("!");if(a=a.substring(1),document.body.innerText.toLowerCase().includes(a)==t)return document.body.innerText,!1}t=t.replace(o,"")}const[i,o]=t.split("!");let a=i.replace(/[.+?^${}()|[\]\\]/g,"\\$&");a=a.replace(/\*/g,".*"),a="^"+a+(o?"":"$");const r=new RegExp(a).test(e);let c=!0;if(o){const t=o.replace(/[.+?^${}()|[\]\\]/g,"\\$&");c=!new RegExp(t).test(e)}return r&&c}}function i(){if(window.baiTrackingConfig?.sentTracking)return;window.baiTrackingConfig.sentTracking=!0;let t=localStorage.getItem("bai-tracking-amount");if(!t&&(totalAmountSelector?.trim&&"ignore"!==totalAmountSelector.trim().toLowerCase()||totalAmountUrl?.trim&&"ignore"!==totalAmountUrl.trim().toLowerCase()))return;t||(t="0");let e=localStorage.getItem("bai-last-interaction");const n={sessionId:localStorage.getItem(window.baiTrackingConfig.chatbotId+"baiSessionId"),chatbotId:window.baiTrackingConfig.chatbotId,event:"Purchase",amount:t,lastInteraction:e};fetch("https://backend.userlink.ai/chatbot/registerTracking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((()=>{localStorage.removeItem("bai-tracking-amount")})).catch((t=>{fetch("https://blueai.dk:6060/chatbot/registerTracking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((()=>{localStorage.removeItem("bai-tracking-amount")})).catch((t=>{window.baiTrackingConfig.sentTracking=!1}))}))}function o(){if(window.baiTrackingConfig?.sentTracking)return;let o=window.baiTrackingConfig,a=o.trackingPaymentAmountUrl,r=o.trackingCheckoutUrl,c=o.trackingPaymentAmountSelector;if(!r)return;a=a.toLowerCase(),r=r.toLowerCase();let l=(window.location.pathname+window.location.search).toLowerCase();l.startsWith("/")&&(l=l.substring(1));let s=!1,g=!1;var u=setInterval((()=>{n(a,l)&&"ignore"!==c&&"ignore"!==a&&(s=!0,t&&clearInterval(t),t=setInterval((()=>{let t=document.querySelector(c);t?.innerText,t&&t.innerText.trim().length>0&&t.innerText!=e&&(localStorage.setItem("bai-tracking-amount",t.innerText),e=t.innerText,g=!0,u&&!n(r,l,!0)&&(clearInterval(u),u=null))}),50)),n(r,l)&&(window.baiTrackingConfig?.sentTracking||i(),u&&(clearInterval(u),u=null))}),200);setTimeout((()=>{u&&(clearInterval(u),u=null)}),3e3)}function a(t,e){fetch("https://"+t+"/public/themes/"+window.baiTrackingConfig.chatbotId+".json",{cache:"no-store"}).then((t=>{t.ok&&t.json().then((t=>{window.baiTrackingConfig={chatbotId:window.baiTrackingConfig.chatbotId,trackingPaymentAmountUrl:t.trackingPaymentAmountUrl,trackingCheckoutUrl:t.trackingCheckoutUrl,trackingPaymentAmountSelector:t.trackingPaymentAmountSelector},sessionStorage.setItem("bai_ti",JSON.stringify(window.baiTrackingConfig)),o()}))})).catch((t=>e(t)))}function r(){let t=sessionStorage.getItem("bai_ti");if(t){let e=JSON.parse(t);window.baiTrackingConfig=e,o()}else{let t=setInterval((()=>{let e=window?.embeddedBlueAiConfig?.chatbotId;if(!e){let t=document.getElementById("bai-emb-tra");t&&(e=t.getAttribute("data-cid"))}e&&(window.baiTrackingConfig={chatbotId:e},a("files.blueai.dk",(()=>a("l2p1.c13.e2-1.dev",(()=>{})))),clearInterval(t))}),10)}}let c=window.location.href;setInterval((()=>{let t=window.location.href;t!=c&&(window.baiTrackingConfig?.sentTracking&&(window.baiTrackingConfig.sentTracking=null),r(),c=t)}),1e3),r()})();