import{gtcChangeColorText,gtcTransitionEnd,gtcScrollLock,gtcScrollUnlock,getPageContentHtml,getSectionHtml,getTemplateHtml,gtcTrapFocus,gtcRemoveTrapFocus,gtcSetPreviousFocus,gtcThrottle}from"gtcUtils";const classes={open:"open",close:"close",overlayOpen:"gtc__overlay-open",scrollLock:"gtc__scroll-lock"},openerArray=[];class GTCOpener extends HTMLElement{static observedAttributes=[classes.open];#rendered=!1;#isBusy=!1;#zIndex=0;constructor(){super(),this.click=this.click.bind(this),this.keydown=gtcThrottle(this.keydown.bind(this),50),this.attachShadow({mode:"open"})}async attributeChangedCallback(name,oldValue,newValue){if(!this.#isBusy)try{if(this.#isBusy=!0,name!==classes.open)return;newValue!==null?this.#rendered===!1?(await this.init(),this.#isBusy=!1):(await this.opening(),this.#isBusy=!1):await this.closing()}catch(error){console.error(error)}finally{this.#isBusy=!1}}get isOpen(){return this.getAttribute(classes.open)==="true"}set isOpen(value){this.setAttribute(classes.open,value?"true":"false")}async connectedCallback(){this.settings={scrollLock:this.getAttribute("scroll-lock")!=="false",changeColorText:this.hasAttribute("change-color-text")||!1,canonicalUrl:this.getAttribute("canonical-url")||"",appendToElement:this.hasAttribute("append-to-element")?this.getAttribute("append-to-element")||"":null,triggerElement:null},await this.appendToElement(),this.setAttribute("aria-hidden",!this.isOpen),this.setAttribute("role","dialog"),this.setAttribute("aria-modal","true")}disconnectedCallback(){this.close()}async init(){this.#rendered===!0?this.open():await this.create()}async appendToElement(){if(this.settings.appended||this.settings.appendToElement===null)return;const target=this.settings.appendToElement!==""?document.querySelector(this.settings.appendToElement):null;this.settings.appended=!0,this.removeAttribute("append-to-element"),target?target.appendChild(this):document.body.appendChild(this)}addListeners(){this.addEventListener("click",this.click,!1),document.addEventListener("keydown",this.keydown,!1)}removeListeners(){this.removeEventListener("click",this.click,!1),document.removeEventListener("keydown",this.keydown,!1)}click(event){const shadowDomTarget=event.composedPath()[0];this.isNotOverlayOrCloseButton(this,shadowDomTarget)||this.close()}isNotOverlayOrCloseButton(element,target){return(element.shadowRoot.contains(target)||element.contains(target))&&!target.closest('[part="overlay"]')&&!target.closest("[data-close]")}keydown(event){event.key==="Escape"&&(event.stopPropagation(),(openerArray.length===0||openerArray[openerArray.length-1]===this)&&requestAnimationFrame(()=>{this.close()}))}open(triggerElement=null){triggerElement&&(this.settings.triggerElement=triggerElement),this.setAttribute(classes.open,"")}close(){this.removeAttribute(classes.open)}opening(){if(openerArray[openerArray.length-1]!==this&&openerArray.push(this),this.#zIndex===0){const styles=window.getComputedStyle(this);this.#zIndex=parseInt(styles.zIndex,10)}this.style.zIndex=this.#zIndex+openerArray.length,this.style.display="block",this.shadowRoot.tabIndex=0,this.offsetHeight,this.settings.scrollLock===!0&&gtcScrollLock([classes.scrollLock]),requestAnimationFrame(()=>{this.addListeners(),this.setAttribute("aria-hidden","false"),gtcTrapFocus(this.shadowRoot)})}closing(){let contentPart=this.shadowRoot.querySelector('[part="content"]');openerArray.splice(openerArray.indexOf(this),1),this.removeListeners(),this.setAttribute("aria-hidden","true"),gtcTransitionEnd(contentPart,()=>{this.style.display="none",this.style.zIndex=this.#zIndex}),this.shadowRoot.tabIndex=-1,openerArray.length===0&&gtcScrollUnlock([classes.scrollLock]),this.settings.triggerElement&&(gtcSetPreviousFocus(this.settings.triggerElement),this.settings.triggerElement=null),gtcRemoveTrapFocus(this)}async getData(){const slots=this.querySelectorAll("[slot]");if(slots.length){const contentDataPromises=Array.from(slots).map(async slot=>{await this.getDataByAttributes(slot)});await Promise.all(contentDataPromises)}}async getDataByAttributes(slot){const data={};for(let i=0;i<slot.attributes.length;i++){const{name:attributeName,value:attributeValue}=slot.attributes[i];if(attributeName)switch(attributeName){case"page":const pageContent=await getPageContentHtml(attributeValue);slot.insertAdjacentHTML("beforeend",pageContent);break;case"section":const sectionContent=await getSectionHtml(attributeValue,this.settings.canonicalUrl);slot.insertAdjacentHTML("beforeend",sectionContent);break;case"template":const templateContent=await getTemplateHtml(attributeValue);slot.insertAdjacentHTML("beforeend",templateContent);break;default:}}return data}async create(){const templateDom=document.getElementById(this.shadowDomTemplate);if(templateDom?this.shadowRoot.appendChild(templateDom.content.cloneNode(!0)):console.warn("Shadow DOM could not be attached: template not found"),await this.getData(),this.shadowRoot.querySelectorAll("slot").forEach(slot=>{slot.assignedElements({flatten:!0}).length||slot.remove()}),this.shadowRoot.querySelectorAll('[part="content"] [part]:not([part="header"] [part])').forEach(part=>{part.children.length||part.remove()}),!this.innerHTML)return console.warn("No HTML IN GTC-OPENER!");if(this.settings?.class){const classes2=this.settings.class.split(" ").filter(letter=>letter!=="");classesList.add(...classes2)}this.settings.changeColorText&&gtcChangeColorText(this),this.#rendered=!0,this.opening()}}const gtcModal=class extends GTCOpener{constructor(){super()}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-modal","true")}get shadowDomTemplate(){return this.getAttribute("template")||"gtc-modal-template"}};window.customElements.get("gtc-modal")||window.customElements.define("gtc-modal",gtcModal);const gtcDrawer=class extends GTCOpener{constructor(){super()}connectedCallback(){super.connectedCallback()}get shadowDomTemplate(){return this.getAttribute("template")||"gtc-drawer-template"}};window.customElements.get("gtc-drawer")||window.customElements.define("gtc-drawer",gtcDrawer);const gtcTrigger=class extends HTMLElement{#isBusy=!1;constructor(){super(),this.click=this.click.bind(this),this.keydown=gtcThrottle(this.keydown.bind(this),50)}connectedCallback(){this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.addListeners()}disconnectedCallback(){this.removelisterners()}addListeners(){this.addEventListener("click",this.click,!1),this.addEventListener("keydown",this.keydown,!1)}removelisterners(){this.removeEventListener("click",this.click,!1),this.removeEventListener("keydown",this.keydown,!1)}keydown(event){this.#isBusy||event.key==="Enter"&&this.open()}click(){this.#isBusy||this.open()}open(){if(this.#isBusy=!0,this.hasAttribute("scripts")&&this.loadScripts(),gtcSetPreviousFocus(this),this.hasAttribute("aria-controls")){const target=document.getElementById(this.getAttribute("aria-controls"));target?target.hasAttribute("open")||target.open(this):(this.removelisterners(),this.setAttribute("disabled",""),console.warn(`No target found with ID: ${this.getAttribute("aria-controls")}`))}this.#isBusy=!1}async loadScripts(){this.getAttribute("scripts").split(",").forEach(script=>{if(document.querySelector(`script[src="${script}"]`))return;const scriptElement=document.createElement("script");scriptElement.src=script,scriptElement.type="module",document.getElementsByTagName("head")[0].appendChild(scriptElement)})}};window.customElements.get("gtc-trigger")||window.customElements.define("gtc-trigger",gtcTrigger);const gtcOpenerLinks=class extends HTMLElement{constructor(){super()}connectedCallback(){this.dom={},this.settings={type:this.getAttribute("type")||"drawer",template:this.getAttribute("template")||"gtc-drawer-template",templateClasses:this.getAttribute("template-classes")||"gtc__drawer",appendToElement:this.hasAttribute("append-to-element")?this.getAttribute("append-to-element")||"":null,scrollLock:this.getAttribute("scroll-lock")!=="false"},document.readyState==="complete"||document.readyState==="interactive"?this.init():document.addEventListener("DOMContentLoaded",()=>{this.init()})}init(){this.settings.appendToElement&&(this.dom.append=document.querySelector(this.settings.appendToElement)),this.checkLinks()}checkLinks(){const baseUrl=window.location.origin;this.querySelectorAll("a").forEach(link=>{const url=link.getAttribute("href");(url.includes(baseUrl)||url.startsWith("/"))&&(url.includes("policies/")||url.includes("pages/"))&&this.tranformToOpener(link)})}async tranformToOpener(link){const randomId=Date.now(),opener=document.createElement(`gtc-${this.settings.type}`),slotTitle=document.createElement("div"),slotBody=document.createElement("div"),trigger=document.createElement("gtc-trigger");trigger.innerHTML=link.innerHTML,trigger.classList.add("inline-link"),trigger.setAttribute("aria-controls",`Opener-${randomId}`),trigger.setAttribute("tabindex",0),trigger.setAttribute("role","button"),trigger.setAttribute("aria-label",link.title),trigger.setAttribute("title",link.title),link.replaceWith(trigger),opener.id=`Opener-${randomId}`,opener.setAttribute("template",this.settings.template),opener.setAttribute("class",this.settings.templateClasses),this.settings.scrollLock===!1&&opener.setAttribute("scroll-lock","false"),slotTitle.setAttribute("slot","title"),slotTitle.innerHTML=link.title,slotBody.setAttribute("slot","body"),slotBody.setAttribute("page",link.href),opener.appendChild(slotTitle),opener.appendChild(slotBody),this.dom.append?this.dom.append.appendChild(opener):this.settings.appendToElement===""&&document.body.appendChild(opener)}};window.customElements.get("gtc-opener-links")||window.customElements.define("gtc-opener-links",gtcOpenerLinks);export{gtcModal,gtcDrawer};
//# sourceMappingURL=/cdn/shop/t/298/assets/gtc-opener.js.map?v=104195070781079033811741080004
